<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Chat Dashboard by Kalzan</title>
    <link rel="stylesheet" href="../assets/css/multichat.css">
    <link rel="shortcut icon" href="../favicon.png" type="image/x-icon">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Orbitron:wght@500;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="app">
        <aside class="sidebar" id="sidebar">
            <h2 style="margin:0 0 12px 0;">Configuração de Chats</h2>
            <div class="left-center">
                <div class="column">

                    <!-- TWITCH -->
                    <div class="e-box"
                        style="background:linear-gradient(180deg, rgba(145,70,255,0.08), rgba(145,70,255,0.02));">
                        <div class="platform-icon bg-twitch">
                            <svg overflow="visible" width="30px" height="30px" version="1.1" viewBox="0 0 40 40" x="0px"
                                y="0px" class="ScSvg-sc-mx5axi-2 jpMUBG">
                                <g>
                                    <polygon points="13 8 8 13 8 31 14 31 14 36 19 31 23 31 32 22 32 8"
                                        class="ScBody-sc-mx5axi-3 dgOmAb">
                                        <animate dur="150ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="points"
                                            from="13 8 8 13 8 31 14 31 14 36 19 31 23 31 32 22 32 8"
                                            to="16 5 8 13 8 31 14 31 14 36 19 31 23 31 35 19 35 5"></animate>
                                        <animate dur="250ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="points"
                                            from="16 5 8 13 8 31 14 31 14 36 19 31 23 31 35 19 35 5"
                                            to="13 8 8 13 8 31 14 31 14 36 19 31 23 31 32 22 32 8"></animate>
                                        <animate dur="50ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="points"
                                            to="13 8 8 13 8 31 14 31 14 36 19 31 23 31 32 22 32 8"
                                            from="16 5 8 13 8 31 14 31 14 36 19 31 23 31 35 19 35 5"></animate>
                                        <animate dur="75ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="points"
                                            to="16 5 8 13 8 31 14 31 14 36 19 31 23 31 35 19 35 5"
                                            from="13 8 8 13 8 31 14 31 14 36 19 31 23 31 32 22 32 8"></animate>
                                    </polygon>
                                    <polygon points="26 25 30 21 30 10 14 10 14 25 18 25 18 29 22 25"
                                        class="ScFace-sc-mx5axi-4 fUZLqr">
                                        <animateTransform dur="150ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="transform"
                                            type="translate" from="0 0" to="3 -3"></animateTransform>
                                        <animateTransform dur="250ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="transform"
                                            type="translate" from="3 -3" to="0 0"></animateTransform>
                                        <animateTransform dur="50ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="transform"
                                            type="translate" from="3 -3" to="0 0"></animateTransform>
                                        <animateTransform dur="75ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="transform"
                                            type="translate" from="0 0" to="3 -3"></animateTransform>
                                    </polygon>
                                    <g class="ScEyes-sc-mx5axi-5 ettoQp">
                                        <path
                                            d="M20,14 L22,14 L22,20 L20,20 L20,14 Z M27,14 L27,20 L25,20 L25,14 L27,14 Z"
                                            class="ScBody-sc-mx5axi-3 dgOmAb">
                                            <animateTransform dur="150ms" begin="indefinite" fill="freeze"
                                                calcMode="spline" keyTimes="0; 1" keySplines="0.25 0.1 0.25 1"
                                                attributeName="transform" type="translate" from="0 0" to="3 -3">
                                            </animateTransform>
                                            <animateTransform dur="250ms" begin="indefinite" fill="freeze"
                                                calcMode="spline" keyTimes="0; 1" keySplines="0.25 0.1 0.25 1"
                                                attributeName="transform" type="translate" from="3 -3" to="0 0">
                                            </animateTransform>
                                            <animateTransform dur="50ms" begin="indefinite" fill="freeze"
                                                calcMode="spline" keyTimes="0; 1" keySplines="0.25 0.1 0.25 1"
                                                attributeName="transform" type="translate" from="3 -3" to="0 0">
                                            </animateTransform>
                                            <animateTransform dur="75ms" begin="indefinite" fill="freeze"
                                                calcMode="spline" keyTimes="0; 1" keySplines="0.25 0.1 0.25 1"
                                                attributeName="transform" type="translate" from="0 0" to="3 -3">
                                            </animateTransform>
                                        </path>
                                    </g>
                                </g>
                            </svg>
                        </div>
                        <input id="twitchUser" placeholder="Twitch Username" autocomplete="off" />
                        <div class="switch-container">
                            <label>Ativar</label>
                            <input type="checkbox" id="twitchToggle" />
                        </div>
                    </div>

                    <!-- YOUTUBE -->
                    <div class="e-box"
                        style="background:linear-gradient(180deg, rgba(255,0,0,0.06), rgba(255,0,0,0.02)); position:relative;">
                        <div class="platform-icon bg-youtube">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 29 20" width="20" height="20"
                                fill="none">
                                <path
                                    d="M14.4848 20C14.4848 20 23.5695 20 25.8229 19.4C27.0917 19.06 28.0459 18.08 28.3808 16.87C29 14.65 29 9.98 29 9.98C29 9.98 29 5.34 28.3808 3.14C28.0459 1.9 27.0917 0.94 25.8229 0.61C23.5695 0 14.4848 0 14.4848 0C14.4848 0 5.42037 0 3.17711 0.61C1.9286 0.94 0.954148 1.9 0.59888 3.14C0 5.34 0 9.98 0 9.98C0 9.98 0 14.65 0.59888 16.87C0.954148 18.08 1.9286 19.06 3.17711 19.4C5.42037 20 14.4848 20 14.4848 20Z"
                                    fill="#FF0033"></path>
                                <path d="M19 10L11.5 5.75V14.25L19 10Z" fill="white"></path>
                            </svg>
                        </div>
                        <input id="youtubeId" placeholder="YouTube Live ID ou link" autocomplete="off" />
                        <div class="switch-container">
                            <label>Ativar</label>
                            <input type="checkbox" id="youtubeToggle" />
                        </div>
                    </div>

                    <!-- KICK -->
                    <div class="e-box"
                        style="background:linear-gradient(180deg, rgba(117,253,70,0.06), rgba(117,253,70,0.02));">
                        <div class="platform-icon bg-kick">
                            <svg width="15" height="15" viewBox="0 0 512 512" fill="#75FD46">
                                <path
                                    d="M37 .036h164.448v113.621h54.71v-56.82h54.731V.036h164.448v170.777h-54.73v56.82h-54.711v56.8h54.71v56.82h54.73V512.03H310.89v-56.82h-54.73v-56.8h-54.711v113.62H37V.036z" />
                            </svg>
                        </div>
                        <input id="kickUser" placeholder="Kick Username" autocomplete="off" />
                        <div class="switch-container">
                            <label>Ativar</label>
                            <input type="checkbox" id="kickToggle" />
                        </div>
                    </div>

                    <!-- TIKTOK -->
                    <div class="e-box unavailable"
                        style="background:linear-gradient(180deg, rgba(255,192,203,0.08), rgba(255,192,203,0.02));">

                        <div class="platform-icon bg-tiktok">
                            <svg width="30" height="30" viewBox="0 0 250 250" xmlns="http://www.w3.org/2000/svg"
                                fill="none">
                                <path
                                    d="M161.167 81.186c10.944 7.819 24.352 12.42 38.832 12.42V65.755a39.26 39.26 0 0 1-8.155-.853v21.923c-14.479 0-27.885-4.601-38.832-12.42v56.835c0 28.432-23.06 51.479-51.505 51.479-10.613 0-20.478-3.207-28.673-8.707C82.187 183.57 95.23 189.5 109.66 189.5c28.447 0 51.508-23.047 51.508-51.48V81.186zm10.06-28.098c-5.593-6.107-9.265-14-10.06-22.726V26.78h-7.728c1.945 11.09 8.58 20.565 17.788 26.308zm-80.402 99.107a23.445 23.445 0 0 1-4.806-14.256c0-13.004 10.548-23.547 23.561-23.547a23.6 23.6 0 0 1 7.147 1.103V87.022a51.97 51.97 0 0 0-8.152-.469v22.162a23.619 23.619 0 0 0-7.15-1.103c-13.013 0-23.56 10.543-23.56 23.548 0 9.195 5.272 17.157 12.96 21.035z"
                                    fill="#ee1d52"></path>
                                <path
                                    d="M153.012 74.405c10.947 7.819 24.353 12.42 38.832 12.42V64.902c-8.082-1.72-15.237-5.942-20.617-11.814-9.208-5.743-15.843-15.218-17.788-26.308H133.14v111.239c-.046 12.968-10.576 23.468-23.561 23.468-7.652 0-14.45-3.645-18.755-9.292-7.688-3.878-12.96-11.84-12.96-21.035 0-13.005 10.547-23.548 23.56-23.548 2.493 0 4.896.388 7.15 1.103V86.553c-27.945.577-50.42 23.399-50.42 51.467 0 14.011 5.597 26.713 14.68 35.993 8.195 5.5 18.06 8.707 28.673 8.707 28.445 0 51.505-23.048 51.505-51.479z"
                                    fill="#ffffff"></path>
                                <path
                                    d="M191.844 64.902v-5.928a38.84 38.84 0 0 1-20.617-5.887 38.948 38.948 0 0 0 20.617 11.815zM153.439 26.78a39.524 39.524 0 0 1-.427-3.198V20h-28.028v111.24c-.045 12.967-10.574 23.467-23.56 23.467-3.813 0-7.412-.904-10.6-2.512 4.305 5.647 11.103 9.292 18.755 9.292 12.984 0 23.515-10.5 23.561-23.468V26.78zm-44.864 59.773v-6.311a51.97 51.97 0 0 0-7.067-.479C73.06 79.763 50 102.811 50 131.24c0 17.824 9.063 33.532 22.835 42.772-9.083-9.28-14.68-21.982-14.68-35.993 0-28.067 22.474-50.889 50.42-51.466z"
                                    fill="#69c9d0"></path>
                            </svg>
                        </div>
                        <input id="tiktokUser" placeholder="TikTok Username" autocomplete="off" disabled />
                        <div class="switch-container">
                            <label>Ativar</label>
                            <input type="checkbox" id="tiktokToggle" disabled />
                        </div>

                        <!-- overlay -->
                        <div class="overlay">
                            Indisponível no momento
                        </div>

                    </div>
                </div>
            </div>

            <!-- Footer -->
            <footer class="app-footer">
                <span class="footer-text">by Kalzan 2025</span>
                <div class="social-links">
                    <a href="../pages/donate.html" target="_blank" class="donate-button">💰 Donate</a>
                    <a href="https://twitch.tv/k4lzan" target="_blank">
                        <svg overflow="visible" width="30px" height="30px" version="1.1" viewBox="0 0 40 40" x="0px"
                            y="0px" class="ScSvg-sc-mx5axi-2 dadDFD">
                            <g>
                                <polygon points="13 8 8 13 8 31 14 31 14 36 19 31 23 31 32 22 32 8"
                                    class="ScBody-sc-mx5axi-3 dadDFD">
                                    <animate dur="150ms" begin="indefinite" fill="freeze" calcMode="spline"
                                        keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="points"
                                        from="13 8 8 13 8 31 14 31 14 36 19 31 23 31 32 22 32 8"
                                        to="16 5 8 13 8 31 14 31 14 36 19 31 23 31 35 19 35 5"></animate>
                                    <animate dur="250ms" begin="indefinite" fill="freeze" calcMode="spline"
                                        keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="points"
                                        from="16 5 8 13 8 31 14 31 14 36 19 31 23 31 35 19 35 5"
                                        to="13 8 8 13 8 31 14 31 14 36 19 31 23 31 32 22 32 8"></animate>
                                    <animate dur="50ms" begin="indefinite" fill="freeze" calcMode="spline"
                                        keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="points"
                                        to="13 8 8 13 8 31 14 31 14 36 19 31 23 31 32 22 32 8"
                                        from="16 5 8 13 8 31 14 31 14 36 19 31 23 31 35 19 35 5"></animate>
                                    <animate dur="75ms" begin="indefinite" fill="freeze" calcMode="spline"
                                        keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="points"
                                        to="16 5 8 13 8 31 14 31 14 36 19 31 23 31 35 19 35 5"
                                        from="13 8 8 13 8 31 14 31 14 36 19 31 23 31 32 22 32 8"></animate>
                                </polygon>
                                <polygon points="26 25 30 21 30 10 14 10 14 25 18 25 18 29 22 25"
                                    class="ScFace-sc-mx5axi-4 ujADWA">
                                    <animateTransform dur="150ms" begin="indefinite" fill="freeze" calcMode="spline"
                                        keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="transform"
                                        type="translate" from="0 0" to="3 -3"></animateTransform>
                                    <animateTransform dur="250ms" begin="indefinite" fill="freeze" calcMode="spline"
                                        keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="transform"
                                        type="translate" from="3 -3" to="0 0"></animateTransform>
                                    <animateTransform dur="50ms" begin="indefinite" fill="freeze" calcMode="spline"
                                        keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="transform"
                                        type="translate" from="3 -3" to="0 0"></animateTransform>
                                    <animateTransform dur="75ms" begin="indefinite" fill="freeze" calcMode="spline"
                                        keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="transform"
                                        type="translate" from="0 0" to="3 -3"></animateTransform>
                                </polygon>
                                <g class="ScEyes-sc-mx5axi-5 dadDFD">
                                    <path d="M20,14 L22,14 L22,20 L20,20 L20,14 Z M27,14 L27,20 L25,20 L25,14 L27,14 Z"
                                        class="ScBody-sc-mx5axi-3 dadDFD">
                                        <animateTransform dur="150ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="transform"
                                            type="translate" from="0 0" to="3 -3">
                                        </animateTransform>
                                        <animateTransform dur="250ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="transform"
                                            type="translate" from="3 -3" to="0 0">
                                        </animateTransform>
                                        <animateTransform dur="50ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="transform"
                                            type="translate" from="3 -3" to="0 0">
                                        </animateTransform>
                                        <animateTransform dur="75ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="transform"
                                            type="translate" from="0 0" to="3 -3">
                                        </animateTransform>
                                    </path>
                                </g>
                            </g>
                        </svg>
                    </a>
                    <a href="https://youtube.com/@k4lzan" target="_blank">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 29 20" width="20" height="20" fill="none">
                            <path
                                d="M14.4848 20C14.4848 20 23.5695 20 25.8229 19.4C27.0917 19.06 28.0459 18.08 28.3808 16.87C29 14.65 29 9.98 29 9.98C29 9.98 29 5.34 28.3808 3.14C28.0459 1.9 27.0917 0.94 25.8229 0.61C23.5695 0 14.4848 0 14.4848 0C14.4848 0 5.42037 0 3.17711 0.61C1.9286 0.94 0.954148 1.9 0.59888 3.14C0 5.34 0 9.98 0 9.98C0 9.98 0 14.65 0.59888 16.87C0.954148 18.08 1.9286 19.06 3.17711 19.4C5.42037 20 14.4848 20 14.4848 20Z"
                                class="ythIDhg"></path>
                            <path d="M19 10L11.5 5.75V14.25L19 10Z" class="ythUySD"></path>
                        </svg>
                    </a>
                    <a href="https://instagram.com/wesleyczans" target="_blank">
                        <svg width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                            data-name="Layer 1">
                            <path
                                d="M17.34,5.46h0a1.2,1.2,0,1,0,1.2,1.2A1.2,1.2,0,0,0,17.34,5.46Zm4.6,2.42a7.59,7.59,0,0,0-.46-2.43,4.94,4.94,0,0,0-1.16-1.77,4.7,4.7,0,0,0-1.77-1.15,7.3,7.3,0,0,0-2.43-.47C15.06,2,14.72,2,12,2s-3.06,0-4.12.06a7.3,7.3,0,0,0-2.43.47A4.78,4.78,0,0,0,3.68,3.68,4.7,4.7,0,0,0,2.53,5.45a7.3,7.3,0,0,0-.47,2.43C2,8.94,2,9.28,2,12s0,3.06.06,4.12a7.3,7.3,0,0,0,.47,2.43,4.7,4.7,0,0,0,1.15,1.77,4.78,4.78,0,0,0,1.77,1.15,7.3,7.3,0,0,0,2.43.47C8.94,22,9.28,22,12,22s3.06,0,4.12-.06a7.3,7.3,0,0,0,2.43-.47,4.7,4.7,0,0,0,1.77-1.15,4.85,4.85,0,0,0,1.16-1.77,7.59,7.59,0,0,0,.46-2.43c0-1.06.06-1.4.06-4.12S22,8.94,21.94,7.88ZM20.14,16a5.61,5.61,0,0,1-.34,1.86,3.06,3.06,0,0,1-.75,1.15,3.19,3.19,0,0,1-1.15.75,5.61,5.61,0,0,1-1.86.34c-1,.05-1.37.06-4,.06s-3,0-4-.06A5.73,5.73,0,0,1,6.1,19.8,3.27,3.27,0,0,1,5,19.05a3,3,0,0,1-.74-1.15A5.54,5.54,0,0,1,3.86,16c0-1-.06-1.37-.06-4s0-3,.06-4A5.54,5.54,0,0,1,4.21,6.1,3,3,0,0,1,5,5,3.14,3.14,0,0,1,6.1,4.2,5.73,5.73,0,0,1,8,3.86c1,0,1.37-.06,4-.06s3,0,4,.06a5.61,5.61,0,0,1,1.86.34A3.06,3.06,0,0,1,19.05,5,3.06,3.06,0,0,1,19.8,6.1,5.61,5.61,0,0,1,20.14,8c.05,1,.06,1.37.06,4S20.19,15,20.14,16ZM12,6.87A5.13,5.13,0,1,0,17.14,12,5.12,5.12,0,0,0,12,6.87Zm0,8.46A3.33,3.33,0,1,1,15.33,12,3.33,3.33,0,0,1,12,15.33Z"
                                class="inDjkad" />
                        </svg>
                    </a>
                </div>
            </footer>

        </aside>

        <main class="main">
            <header>
                <h1>🌐 Multi Chat — Moderação e Visualização</h1>
                <div class="header-controls">
                    <button class="btn" id="themeBtn" title="Alternar tema">🌙/☀️</button>
                    <button class="btn" id="obsBtn" title="Modo OBS">
                        <img src="../assets/images/obs.png" alt="OBS Logo">
                        OBS Mode
                    </button>
                </div>
            </header>

            <section class="chats" id="chatArea" aria-live="polite"></section>
        </main>

    </div>

    <button class="floating-gear" id="floatingGear" title="Abrir controles">⚙️</button>

    <script>
        (function () {
            const chatArea = document.getElementById('chatArea');
            const twitchInput = document.getElementById('twitchUser');
            const twitchToggle = document.getElementById('twitchToggle');

            const youtubeInput = document.getElementById('youtubeId');
            const youtubeToggle = document.getElementById('youtubeToggle');

            const kickInput = document.getElementById('kickUser');
            const kickToggle = document.getElementById('kickToggle');

            const tiktokInput = document.getElementById('tiktokUser');
            const tiktokToggle = document.getElementById('tiktokToggle');

            const obsBtn = document.getElementById('obsBtn');
            const themeBtn = document.getElementById('themeBtn');
            const floatingGear = document.getElementById('floatingGear');

            function cardIdFor(platform, id) { return `${platform}__${id.replace(/\s+/g, '').toLowerCase()}`; }

            function addChatCard(platform, id, iframeSrc) {
                const cid = cardIdFor(platform, id);
                if (document.getElementById(cid)) return;
                const card = document.createElement('div');
                card.className = 'chat-card';
                card.id = cid;
                card.draggable = true;

                let iconHTML = '';
                if (platform === 'twitch') iconHTML = ` <svg overflow="visible" width="30px" height="30px" version="1.1" viewBox="0 0 40 40" x="0px"
                                y="0px" class="ScSvg-sc-mx5axi-2 jpMUBG">
                                <g>
                                    <polygon points="13 8 8 13 8 31 14 31 14 36 19 31 23 31 32 22 32 8"
                                        class="ScBody-sc-mx5axi-3 dgOmAb">
                                        <animate dur="150ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="points"
                                            from="13 8 8 13 8 31 14 31 14 36 19 31 23 31 32 22 32 8"
                                            to="16 5 8 13 8 31 14 31 14 36 19 31 23 31 35 19 35 5"></animate>
                                        <animate dur="250ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="points"
                                            from="16 5 8 13 8 31 14 31 14 36 19 31 23 31 35 19 35 5"
                                            to="13 8 8 13 8 31 14 31 14 36 19 31 23 31 32 22 32 8"></animate>
                                        <animate dur="50ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="points"
                                            to="13 8 8 13 8 31 14 31 14 36 19 31 23 31 32 22 32 8"
                                            from="16 5 8 13 8 31 14 31 14 36 19 31 23 31 35 19 35 5"></animate>
                                        <animate dur="75ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="points"
                                            to="16 5 8 13 8 31 14 31 14 36 19 31 23 31 35 19 35 5"
                                            from="13 8 8 13 8 31 14 31 14 36 19 31 23 31 32 22 32 8"></animate>
                                    </polygon>
                                    <polygon points="26 25 30 21 30 10 14 10 14 25 18 25 18 29 22 25"
                                        class="ScFace-sc-mx5axi-4 fUZLqr">
                                        <animateTransform dur="150ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="transform"
                                            type="translate" from="0 0" to="3 -3"></animateTransform>
                                        <animateTransform dur="250ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="transform"
                                            type="translate" from="3 -3" to="0 0"></animateTransform>
                                        <animateTransform dur="50ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="transform"
                                            type="translate" from="3 -3" to="0 0"></animateTransform>
                                        <animateTransform dur="75ms" begin="indefinite" fill="freeze" calcMode="spline"
                                            keyTimes="0; 1" keySplines="0.25 0.1 0.25 1" attributeName="transform"
                                            type="translate" from="0 0" to="3 -3"></animateTransform>
                                    </polygon>
                                    <g class="ScEyes-sc-mx5axi-5 ettoQp">
                                        <path
                                            d="M20,14 L22,14 L22,20 L20,20 L20,14 Z M27,14 L27,20 L25,20 L25,14 L27,14 Z"
                                            class="ScBody-sc-mx5axi-3 dgOmAb">
                                            <animateTransform dur="150ms" begin="indefinite" fill="freeze"
                                                calcMode="spline" keyTimes="0; 1" keySplines="0.25 0.1 0.25 1"
                                                attributeName="transform" type="translate" from="0 0" to="3 -3">
                                            </animateTransform>
                                            <animateTransform dur="250ms" begin="indefinite" fill="freeze"
                                                calcMode="spline" keyTimes="0; 1" keySplines="0.25 0.1 0.25 1"
                                                attributeName="transform" type="translate" from="3 -3" to="0 0">
                                            </animateTransform>
                                            <animateTransform dur="50ms" begin="indefinite" fill="freeze"
                                                calcMode="spline" keyTimes="0; 1" keySplines="0.25 0.1 0.25 1"
                                                attributeName="transform" type="translate" from="3 -3" to="0 0">
                                            </animateTransform>
                                            <animateTransform dur="75ms" begin="indefinite" fill="freeze"
                                                calcMode="spline" keyTimes="0; 1" keySplines="0.25 0.1 0.25 1"
                                                attributeName="transform" type="translate" from="0 0" to="3 -3">
                                            </animateTransform>
                                        </path>
                                    </g>
                                </g>
                            </svg>`;
                if (platform === 'youtube') iconHTML = ` <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 29 20" width="20" height="20"
                                fill="none">
                                <path
                                    d="M14.4848 20C14.4848 20 23.5695 20 25.8229 19.4C27.0917 19.06 28.0459 18.08 28.3808 16.87C29 14.65 29 9.98 29 9.98C29 9.98 29 5.34 28.3808 3.14C28.0459 1.9 27.0917 0.94 25.8229 0.61C23.5695 0 14.4848 0 14.4848 0C14.4848 0 5.42037 0 3.17711 0.61C1.9286 0.94 0.954148 1.9 0.59888 3.14C0 5.34 0 9.98 0 9.98C0 9.98 0 14.65 0.59888 16.87C0.954148 18.08 1.9286 19.06 3.17711 19.4C5.42037 20 14.4848 20 14.4848 20Z"
                                    fill="#FF0033"></path>
                                <path d="M19 10L11.5 5.75V14.25L19 10Z" fill="white"></path>
                            </svg>`;
                if (platform === 'kick') iconHTML = ` <svg width="15" height="15" viewBox="0 0 512 512" fill="#75FD46">
                                <path
                                    d="M37 .036h164.448v113.621h54.71v-56.82h54.731V.036h164.448v170.777h-54.73v56.82h-54.711v56.8h54.71v56.82h54.73V512.03H310.89v-56.82h-54.73v-56.8h-54.711v113.62H37V.036z" />
                            </svg>`;
                if (platform === 'tiktok') iconHTML = `  <svg width="30" height="30" viewBox="0 0 250 250" xmlns="http://www.w3.org/2000/svg"
                                fill="none">
                                <path
                                    d="M161.167 81.186c10.944 7.819 24.352 12.42 38.832 12.42V65.755a39.26 39.26 0 0 1-8.155-.853v21.923c-14.479 0-27.885-4.601-38.832-12.42v56.835c0 28.432-23.06 51.479-51.505 51.479-10.613 0-20.478-3.207-28.673-8.707C82.187 183.57 95.23 189.5 109.66 189.5c28.447 0 51.508-23.047 51.508-51.48V81.186zm10.06-28.098c-5.593-6.107-9.265-14-10.06-22.726V26.78h-7.728c1.945 11.09 8.58 20.565 17.788 26.308zm-80.402 99.107a23.445 23.445 0 0 1-4.806-14.256c0-13.004 10.548-23.547 23.561-23.547a23.6 23.6 0 0 1 7.147 1.103V87.022a51.97 51.97 0 0 0-8.152-.469v22.162a23.619 23.619 0 0 0-7.15-1.103c-13.013 0-23.56 10.543-23.56 23.548 0 9.195 5.272 17.157 12.96 21.035z"
                                    fill="#ee1d52"></path>
                                <path
                                    d="M153.012 74.405c10.947 7.819 24.353 12.42 38.832 12.42V64.902c-8.082-1.72-15.237-5.942-20.617-11.814-9.208-5.743-15.843-15.218-17.788-26.308H133.14v111.239c-.046 12.968-10.576 23.468-23.561 23.468-7.652 0-14.45-3.645-18.755-9.292-7.688-3.878-12.96-11.84-12.96-21.035 0-13.005 10.547-23.548 23.56-23.548 2.493 0 4.896.388 7.15 1.103V86.553c-27.945.577-50.42 23.399-50.42 51.467 0 14.011 5.597 26.713 14.68 35.993 8.195 5.5 18.06 8.707 28.673 8.707 28.445 0 51.505-23.048 51.505-51.479z"
                                    fill="#ffffff"></path>
                                <path
                                    d="M191.844 64.902v-5.928a38.84 38.84 0 0 1-20.617-5.887 38.948 38.948 0 0 0 20.617 11.815zM153.439 26.78a39.524 39.524 0 0 1-.427-3.198V20h-28.028v111.24c-.045 12.967-10.574 23.467-23.56 23.467-3.813 0-7.412-.904-10.6-2.512 4.305 5.647 11.103 9.292 18.755 9.292 12.984 0 23.515-10.5 23.561-23.468V26.78zm-44.864 59.773v-6.311a51.97 51.97 0 0 0-7.067-.479C73.06 79.763 50 102.811 50 131.24c0 17.824 9.063 33.532 22.835 42.772-9.083-9.28-14.68-21.982-14.68-35.993 0-28.067 22.474-50.889 50.42-51.466z"
                                    fill="#69c9d0"></path>
                            </svg>`;

                card.innerHTML = `
                <div class="chat-actions">
                    <button title="Fechar">
                        <svg class="svg-close" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="chat-header">${iconHTML} ${platform.toUpperCase()} — ${id}</div>
                <div class="chat-embed"><iframe src="${iframeSrc}" width="100%" height="100%" frameborder="0" allowfullscreen></iframe></div>
                `;

                const closeBtn = card.querySelector('.chat-actions button');
                closeBtn.addEventListener('click', () => {
                    card.remove();
                    if (platform === 'twitch') {
                        twitchToggle.checked = false;
                        twitchInput.value = "";
                    }
                    if (platform === 'youtube') {
                        youtubeToggle.checked = false;
                        youtubeInput.value = "";

                    }
                    if (platform === 'kick') {
                        kickToggle.checked = false;
                        kickInput.value = "";
                    }
                    if (platform === 'tiktok') {
                        tiktokToggle.checked = false;
                        tiktokInput.value = "";
                    }
                });
                chatArea.appendChild(card);
                enableDrag(card);
            }
            const parentDomain = window.location.hostname;
            function twitchEmbedFor(channel) { return `https://www.twitch.tv/embed/${encodeURIComponent(channel)}/chat?darkpopout&parent=${parentDomain}`; }

            function youtubeEmbedFor(input) {
                try {
                    if (input.includes('youtube') || input.includes('youtu.be')) {
                        const url = new URL(input, window.location.href);
                        const v = url.searchParams.get('v');
                        if (v) return `https://www.youtube.com/live_chat?v=${v}&embed_domain=${parentDomain}`;
                        const pathParts = url.pathname.split('/');
                        const maybe = pathParts[pathParts.length - 1];
                        if (maybe) return `https://www.youtube.com/live_chat?v=${maybe}&embed_domain=${parentDomain}`;
                    }
                } catch (e) { }
                return `https://www.youtube.com/live_chat?v=${encodeURIComponent(input)}&embed_domain=${parentDomain}`;
            }

            function kickEmbedFor(channel) { return `https://kick.com/popout/${encodeURIComponent(channel)}/chat`; }

            function addTikTokChat(username) {
                const cid = cardIdFor('tiktok', username);
                if (document.getElementById(cid)) return;

                const card = document.createElement('div');
                card.className = 'chat-card';
                card.id = cid;
                card.draggable = true;

                card.innerHTML = `
                <div class="chat-actions">
                    <button title="Fechar">
                        <svg class="svg-close" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="chat-header">${iconHTML} ${platform.toUpperCase()} — ${username}</div>
                <div class="chat-embed tiktok-messages"></div>
                 `;

                const closeBtn = card.querySelector('.chat-actions button');
                closeBtn.addEventListener('click', () => {
                    card.remove();
                    tiktokToggle.checked = false;
                    fetch('/stop-tiktok?username=' + encodeURIComponent(username));
                });

                chatArea.appendChild(card);
                enableDrag(card);

                // inicia polling no backend
                fetch(`/start-tiktok?username=${encodeURIComponent(username)}`);

                // garante listener global
                if (!window.tiktokSocketListenerAdded) {
                    window.tiktokSocketListenerAdded = true;
                    socket.on('tiktokMessage', (data) => {
                        const { user, text, username: fromUsername } = data;
                        const chatCard = document.getElementById(cardIdFor('tiktok', fromUsername));
                        if (!chatCard) return; // se o card não existe, ignora
                        const chatBox = chatCard.querySelector('.tiktok-messages');
                        const div = document.createElement('div');
                        div.className = 'chat-message';
                        div.textContent = `${user}: ${text}`;
                        chatBox.appendChild(div);
                        chatBox.scrollTop = chatBox.scrollHeight;
                    });
                }
            }

            function enableDrag(card) {
                card.addEventListener('dragstart', e => {
                    card.classList.add('dragging');
                });
                card.addEventListener('dragend', e => {
                    card.classList.remove('dragging');
                });
                chatArea.addEventListener('dragover', e => {
                    e.preventDefault();
                    const dragging = document.querySelector('.dragging');
                    const afterElement = getDragAfterElement(chatArea, e.clientY);
                    if (afterElement == null) chatArea.appendChild(dragging);
                    else chatArea.insertBefore(dragging, afterElement);
                });
            }

            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('.chat-card:not(.dragging)')];
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    if (offset < 0 && offset > closest.offset) return { offset: offset, element: child };
                    else return closest;
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }

            function handleToggle(input, toggle, platform, embedFn) {
                toggle.addEventListener('change', () => {
                    const val = input.value.trim();
                    if (toggle.checked) {
                        if (val) addChatCard(platform, val, embedFn(val));
                        else toggle.checked = false;
                    } else {
                        const el = document.getElementById(cardIdFor(platform, val));
                        if (el) el.remove();
                        input.value = '';
                    }
                });
            }

            handleToggle(twitchInput, twitchToggle, 'twitch', twitchEmbedFor);
            handleToggle(youtubeInput, youtubeToggle, 'youtube', youtubeEmbedFor);
            handleToggle(kickInput, kickToggle, 'kick', kickEmbedFor);
            handleToggle(tiktokInput, tiktokToggle, 'tiktok', () => '');

            obsBtn.addEventListener('click', () => { document.body.classList.toggle('clean'); });
            floatingGear.addEventListener('click', () => { document.body.classList.remove('clean'); window.scrollTo({ top: 0, behavior: 'smooth' }); });
            const observer = new MutationObserver(() => { floatingGear.style.display = document.body.classList.contains('clean') ? 'flex' : 'none'; });
            observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });

            themeBtn.addEventListener('click', () => { document.body.classList.toggle('light'); });
        })();
    </script>
</body>

</html>