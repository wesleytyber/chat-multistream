<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MultiChat Twitch</title>
  <link rel="stylesheet" href="chat.css">
  <script src="/socket.io/socket.io.js"></script>
</head>

<body>
  <div class="container">
    <!-- Left side: Configurações -->
    <div class="config">
      <h2>Conectar Canal</h2>
      <input type="text" id="channel" placeholder="Nome do canal Twitch">
      <button id="connectBtn">Conectar</button>

      <h3>General</h3>
      <label>Espaço entre mensagens <input type="range" id="msgSpacing" min="0" max="50" value="5"></label>
      <label>Margem entre mensagens <input type="range" id="msgMargin" min="0" max="50" value="5"></label>
      <label>Rotate X Axis <input type="range" id="rotateX" min="-180" max="180" value="0"></label>
      <label>Rotate Y Axis <input type="range" id="rotateY" min="-180" max="180" value="0"></label>
      <label>Rotate Z Axis <input type="range" id="rotateZ" min="-180" max="180" value="0"></label>

      <h3>Username</h3>
      <label>Font <input type="text" id="usernameFont" placeholder="e.g., Arial"></label>
      <label>Colour <input type="color" id="usernameColor" value="#FFFFFF"></label>
      <label>Background <input type="color" id="usernameBg" value="#000000"></label>
      <label>Font Size <input type="number" id="usernameSize" value="14"></label>
      <label>Font Weight <input type="number" id="usernameWeight" value="600"></label>
      <label>Border Radius <input type="number" id="usernameRadius" value="3"></label>
      <label>Padding <input type="number" id="usernamePadding" value="2"></label>

      <h3>Chat Message</h3>
      <label>Font <input type="text" id="messageFont" placeholder="e.g., Arial"></label>
      <label>Colour <input type="color" id="messageColor" value="#FFFFFF"></label>
      <label>Background <input type="color" id="messageBg" value="#000000"></label>
      <label>Font Size <input type="number" id="messageSize" value="14"></label>
      <label>Font Weight <input type="number" id="messageWeight" value="400"></label>
      <label>Border Radius <input type="number" id="messageRadius" value="3"></label>
      <label>Padding <input type="number" id="messagePadding" value="2"></label>

      <h3>Copiar para OBS</h3>
      <label>URL do overlay:
        <input type="text" id="obsUrl" readonly>
        <button onclick="copyToClipboard('obsUrl')">Copiar URL</button>
      </label>
      <label>CSS customizado:
        <textarea id="obsCss" readonly></textarea>
        <button onclick="copyToClipboard('obsCss')">Copiar CSS</button>
      </label>
    </div>

    <!-- Right side: Preview -->
    <div class="preview" id="previewChat">
      <div class="chat-message">
        <span class="username">Username</span>: <span class="message">Mensagem de exemplo</span>
      </div>
      <div class="chat-message">
        <span class="username">Streamer</span>: <span class="message">Olá, isso é um preview!</span>
      </div>
    </div>
  </div>

  <div id="chat"></div>

  <script>
    const socket = io();
    const chatDiv = document.getElementById('chat');
    const twitchIcon = '<img class="twitch-icon" src="https://upload.wikimedia.org/wikipedia/commons/d/d3/Twitch_Glitch_Logo_Purple.svg" alt="Twitch">';

    document.getElementById('connectBtn').addEventListener('click', () => {
      const channel = document.getElementById('channel').value.trim();
      if (channel) socket.emit('join-channel', channel);
    });

    socket.on('new-message', (msg) => {
      const div = document.createElement('div');
      div.classList.add('chat-message');
      div.innerHTML = `${twitchIcon} ${msg.badges.join(' ')} <b style="color:${msg.color}">${msg.user}:</b> ${msg.message}`;
      chatDiv.appendChild(div);
      chatDiv.scrollTop = chatDiv.scrollHeight;
    });

    const preview = document.getElementById('previewChat');

    function updatePreview() {
      const messages = preview.querySelectorAll('.chat-message');

      // General
      const spacing = document.getElementById('msgSpacing').value + 'px';
      const margin = document.getElementById('msgMargin').value + 'px';
      const rotateX = document.getElementById('rotateX').value;
      const rotateY = document.getElementById('rotateY').value;
      const rotateZ = document.getElementById('rotateZ').value;

      preview.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) rotateZ(${rotateZ}deg)`;

      messages.forEach(msg => {
        msg.style.marginBottom = margin;
        msg.style.paddingBottom = spacing;

        // Username
        const username = msg.querySelector('.username');
        username.style.fontFamily = document.getElementById('usernameFont').value;
        username.style.color = document.getElementById('usernameColor').value;
        username.style.backgroundColor = document.getElementById('usernameBg').value;
        username.style.fontSize = document.getElementById('usernameSize').value + 'px';
        username.style.fontWeight = document.getElementById('usernameWeight').value;
        username.style.borderRadius = document.getElementById('usernameRadius').value + 'px';
        username.style.padding = document.getElementById('usernamePadding').value + 'px';

        // Message
        const message = msg.querySelector('.message');
        message.style.fontFamily = document.getElementById('messageFont').value;
        message.style.color = document.getElementById('messageColor').value;
        message.style.backgroundColor = document.getElementById('messageBg').value;
        message.style.fontSize = document.getElementById('messageSize').value + 'px';
        message.style.fontWeight = document.getElementById('messageWeight').value;
        message.style.borderRadius = document.getElementById('messageRadius').value + 'px';
        message.style.padding = document.getElementById('messagePadding').value + 'px';
      });
    }

    function updateOverlayInfo() {
      // URL do overlay
      const channel = document.getElementById('channel').value.trim() || 'exampleChannel';
      document.getElementById('obsUrl').value = `${window.location.origin}/chat.html?channel=${channel}`;

      // CSS customizado
      const css = `
.chat-message {
  margin-bottom: ${document.getElementById('msgMargin').value}px;
  padding-bottom: ${document.getElementById('msgSpacing').value}px;
  transform: rotateX(${document.getElementById('rotateX').value}deg)
             rotateY(${document.getElementById('rotateY').value}deg)
             rotateZ(${document.getElementById('rotateZ').value}deg);
}
.username {
  font-family: ${document.getElementById('usernameFont').value};
  color: ${document.getElementById('usernameColor').value};
  background-color: ${document.getElementById('usernameBg').value};
  font-size: ${document.getElementById('usernameSize').value}px;
  font-weight: ${document.getElementById('usernameWeight').value};
  border-radius: ${document.getElementById('usernameRadius').value}px;
  padding: ${document.getElementById('usernamePadding').value}px;
}
.message {
  font-family: ${document.getElementById('messageFont').value};
  color: ${document.getElementById('messageColor').value};
  background-color: ${document.getElementById('messageBg').value};
  font-size: ${document.getElementById('messageSize').value}px;
  font-weight: ${document.getElementById('messageWeight').value};
  border-radius: ${document.getElementById('messageRadius').value}px;
  padding: ${document.getElementById('messagePadding').value}px;
}
  `;
      document.getElementById('obsCss').value = css;
    }

    // atualiza preview + URL + CSS ao mudar qualquer input
    document.querySelectorAll('.config input, .config textarea').forEach(input => {
      input.addEventListener('input', () => {
        updatePreview();    // atualiza preview visual
        updateOverlayInfo(); // atualiza URL e CSS
      });
    });

    updatePreview(); // inicializar
    updateOverlayInfo();

    function copyToClipboard(id) {
      const el = document.getElementById(id);
      el.select ? el.select() : el.focus();
      document.execCommand('copy');
      alert('Copiado!');
    }

  </script>
</body>

</html>